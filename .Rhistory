knitr::opts_chunk$set(echo = TRUE, fig.height = 6)
options(tinytex.verbose = TRUE)
library(dplyr)
library(tidyverse)
library(tidytext)
library(lubridate)
library(xml2)
library(rvest)
library(stringr)
library(rvest)
library(gutenbergr)   # for the text
library(tidyr)   # for separate_rows
library(gridExtra)    #to make side-by-side figure
library(choroplethr)
library(choroplethrMaps)
library(sf)
library(scales)   # for percent()
# import the data
education_raw <- "https://worldpopulationreview.com/states/most-educated-states/" %>%
read_html() %>%
html_table(fill=TRUE) %>%
.[[1]]
education_raw
knitr::opts_chunk$set(echo = TRUE, fig.height = 6)
options(tinytex.verbose = TRUE)
library(dplyr)
library(tidyverse)
library(tidytext)
library(lubridate)
library(xml2)
library(rvest)
library(stringr)
library(rvest)
library(gutenbergr)   # for the text
library(tidyr)   # for separate_rows
library(gridExtra)    #to make side-by-side figure
library(choroplethr)
library(choroplethrMaps)
library(sf)
library(scales)   # for percent()
# import the data
COVID_19_raw <- "https://www.worldometers.info/coronavirus/country/us/" %>%
read_html() %>%
html_table(fill=TRUE) %>%
.[[1]]
# head(COVID_19_raw)
# extract the rows and columns needed
COVID_19_full <- data.frame(COVID_19_raw)
COVID_19_full <- COVID_19_full[-c(1,53:nrow(COVID_19_full)),]
colnames(COVID_19_full)
COVID_19_full <- COVID_19_full %>%
dplyr::select(USAState, TotalCases, TotalDeaths,Tot.Cases.1M.pop,Deaths.1M.pop,Tests.1M.pop) %>%
arrange(USAState)
# head(COVID_19_full)
# total cases
total_cases <- COVID_19_full %>%
dplyr::select(USAState, TotalCases)
# match with choroplethr package
# change column name
names(total_cases) <- c("region", "value")
# change state name to lower letter
total_cases$region <- tolower(total_cases$region)
total_cases$region
# remove comma from value
total_cases$value <- as.numeric(gsub(",", "", total_cases$value))
# total deaths
total_deaths <- COVID_19_full %>%
dplyr::select(USAState, TotalDeaths)
## match with choroplethr package
# change column name
names(total_deaths) <- c("region", "value")
# change state name to lower letter
total_deaths$region <- tolower(total_deaths$region)
# remove comma from value
total_deaths$value <- as.numeric(gsub(",", "", total_deaths$value))
# fill NA with 0
total_deaths$value <- replace_na(total_deaths$value, 0)
# create two side-by-side choropleth maps of COVID-19 cases and deaths in the USA
data(continental_us_states)
grid.arrange(state_choropleth(total_cases, title  = "Covid-19 toal cases in the US", zoom = continental_us_states),
state_choropleth(total_deaths, title  = "Covid-19 toal deaths in the US", zoom = continental_us_states))
# import the data
political_raw <- "https://www.nytimes.com/elections/2016/results/president" %>%
read_html() %>%
html_table(fill=TRUE)
# political_raw
# clean table 1 and 2
first_two <- rbind(political_raw[[1]],political_raw[[2]]) %>%
dplyr::select(State,Clinton,Trump,Other) %>%
mutate(Democratic = as.numeric(gsub("[^0-9]","",Clinton))/100) %>%
mutate(Republic = as.numeric(gsub("[^0-9]","",Trump))/100) %>%
mutate(Other = as.numeric(gsub("[^0-9]","",Other))/100) %>%
dplyr::select(State,Democratic,Republic,Other)
#Democratic = percent(as.numeric(gsub("[^0-9]","",Clinton))/100)
others <- rbind(political_raw[[3]],political_raw[[4]],political_raw[[5]],political_raw[[6]],political_raw[[7]]) %>%
dplyr::select(State,Dem.,Rep.,Oth.) %>%
mutate(Democratic = as.numeric(gsub("[^0-9]","",Dem.))/100) %>%
mutate(Republic = as.numeric(gsub("[^0-9]","",Rep.))/100) %>%
mutate(Other = as.numeric(gsub("[^0-9]","",Oth.))/100) %>%
dplyr::select(State,Democratic,Republic,Other)
# sum = Democratic+Republic+Other is not 1 actually
political <- rbind(first_two,others) %>%
arrange(State) %>%
unique() %>%
mutate(region = c("alabama","alaska","arizona","arkansas","california","colorado","connecticut","district of columbia","delaware","florida","georgia","hawaii","idaho","illinois","indiana","iowa","kansas","kentucky","louisiana","massachusetts","maryland","maine","michigan","minnesota","mississippi","missouri","montana","north carolina","north dakota","new hampshire","new jersey","new mexico","new york","nebraska","nevada","ohio","oklahoma","oregon","pennsylvania","rhode island","south carolina","south dakota","tennessee","texas","utah","virginia","vermont","west virginia","washington","wisconsin","wyoming"))
# add the region names by hand, pay attendsion on such as district of colunmbia which in short is D.C. and stand after delaware, stand in front of it.
Dem <- political %>%
select(region,Democratic)
names(Dem) <- c("region","value")
Rep <- political %>%
select(region,Republic)
names(Rep) <- c("region","value")
data(continental_us_states)
grid.arrange(state_choropleth(Dem, title  = "Democratic Support in 2016", zoom = continental_us_states),
state_choropleth(Rep, title  = "Republic Support in 2016", zoom = continental_us_states))
View(total_deaths)
View(education_raw)
# import the data
education_raw <- "https://worldpopulationreview.com/states/most-educated-states/" %>%
read_html() %>%
html_table(fill=TRUE) %>%
.[[1]]
education <- education_raw %>%
select(State,`Education Score`)
education$State <- tolower(education$State)
names(education) <- c("region","value")
head(education)
# import the data
education_raw <- "https://worldpopulationreview.com/states/most-educated-states/" %>%
read_html() %>%
html_table(fill=TRUE) %>%
.[[1]]
education <- education_raw %>%
select(State,`Education Score`)
education$State <- tolower(education$State)
names(education) <- c("region","value")
head(education)
grid.arrange(state_choropleth(education, title  = "Education Level in US", zoom = continental_us_states))
# import the data
pop_density_raw <- "https://simple.wikipedia.org/wiki/List_of_U.S._states_by_population_density" %>%
read_html() %>%
html_table(fill=TRUE) %>%
.[[4]]
pop_density_raw
# import the data
GDP_raw <- "https://en.wikipedia.org/wiki/List_of_U.S._states_and_territories_by_GDP" %>%
read_html() %>%
html_table(fill=TRUE) %>%
.[[3]]
GDP_raw
# import the data
pop_density_raw <- "https://simple.wikipedia.org/wiki/List_of_U.S._states_by_population_density" %>%
read_html() %>%
html_table(fill=TRUE) %>%
.[[4]]
pop_density <- pop_density_raw %>%
select(State/Territory/Division/Region,Dens./sqmi)
# import the data
pop_density_raw <- "https://simple.wikipedia.org/wiki/List_of_U.S._states_by_population_density" %>%
read_html() %>%
html_table(fill=TRUE) %>%
.[[4]]
pop_density <- pop_density_raw %>%
select(`State/Territory/Division/Region`,`Dens./sqmi`)
names(pop_density) <- c("region","value")
pop_density$region <- tolower(pop_density$region)
head(pop_density)
grid.arrange(state_choropleth(pop_density, title  = "Education Level in US", zoom = continental_us_states))
View(pop_density)
